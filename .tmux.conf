# Remap prefix to Ctrl+Space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Reload config
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# Easier splits
bind | split-window -h
bind - split-window -v

# Mouse support
set -g mouse on

# Copy to system clipboard (macOS)
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Faster escape time
set -sg escape-time 10

# Active pane border
set -g focus-events on
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour218
set -g window-style default
set -g window-active-style default

# Better colors
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB,alacritty:RGB"

# Increase scrollback
set -g history-limit 50000

# Popup tools (prefix + key opens floating window)
bind g display-popup -d "#{pane_current_path}" -w 90% -h 90% -E "lazygit"
bind t display-popup -d "#{pane_current_path}" -w 80% -h 60% -E "bb tasks 2>/dev/null | fzf --header 'bb tasks' | awk '{print $1}' | xargs -I{} bb {}"
bind p display-popup -d "#{pane_current_path}" -w 60% -h 40% -E "ports; echo; echo 'Press enter to close'; read"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Shift+arrows to switch windows without prefix
bind -n S-Left previous-window
bind -n S-Right next-window

# fzf session switcher
bind s display-popup -w 60% -h 40% -E "tmux list-sessions -F '#{session_name}' | fzf --header 'Switch session  (ctrl+d kill  ctrl+n new  ctrl+r rename)' --bind 'ctrl-d:execute(tmux kill-session -t {})+reload(tmux list-sessions -F #{session_name} 2>/dev/null)' --bind 'ctrl-n:execute-silent(tmux new-session -d -s {q})+reload(tmux list-sessions -F #{session_name} 2>/dev/null)+clear-query' --bind 'ctrl-r:execute(read -p \"New name: \" n && tmux rename-session -t {} \"$n\")+reload(tmux list-sessions -F #{session_name} 2>/dev/null)' | grep . | xargs -I{} tmux switch-client -t {}"
